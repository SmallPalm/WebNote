# 哪段代码运行效率更高 ( 隐藏类 )

```js
// A段代码
const obj1 = {
  a: 1
}
const obj2 = {
  a: 1
}
const obj3 = {
  a: 1
}
```

```js
// B段代码
const obj1 = {
  a: 2
}
const obj2 = {
  b: 2
}
const obj3 = {
  c: 2
}
```

A段代码效率更高, 重用了隐藏类 ( Hidden Class )

```js
// A测试代码 : a: 11.449951171875 ms
console.time("a");

for(let i = 0; i < 1000000; i++){
  const obj = {};
  obj["a"] = i
}
console.timeEnd("a")

// B测试代码 : b: 368.33984375 ms
console.time("b");

for(let j = 0; j < 1000000; i++){
  const obj = {}
  obj[`${j}`] = j
}
console.timeEnd("b")
```



# JS运行机制

浏览器 -> 内核 -> JS解析引擎

|     浏览器      | 内核                    | JS解析引擎     |
| :-------------: | ----------------------- | -------------- |
|     Chrome      | 早期Webkit, 现目前Blink | V8             |
| Mozilla Firefox | Gecko                   | SpiderMonkey   |
|      Edge       | Chromium                | Chakra         |
|     Safari      | Webkit                  | JavaScriptCore |

- 现在比较主流 的 JS引擎就是 V8引擎 , 在这里假设是跑在Chrome或node上, 用的是V8引擎
- V8是一个C++实现的JS解析引擎 , 内部利用隐藏类 (Hidden Class) 的方式来存放 JS 对象
- 隐藏类的特性是 : 多个**属性名一致并且顺序一致** 的 JS对象
  - 会重用同一个隐藏类, 减少new Class的开销
- 所以 A 代码生成了 1个隐藏类, 而 B 代码生成了 3 个隐藏类
  - 因此 A 代码的性能更好

代码编写习惯 : 定义对象或者类时, 尽可能保证属性的顺序一致

