# 进程和线程

- 进程和线程是操作系统中的两个概念
  - 进程 ( process ) 
    - 计算机已经运行的程序 , 是操作系统管理程序的一种方法
  - 线程 ( thread )
    - 操作系统能够运行运算调度的最小单位
      - 通常情况下它被包含在进程中
- 进程
  - 可以认为, 启动一个应用程序, 就会默认启动一个进程 (也可能是多个进程)
- 线程
  - 每一个进程中, 都会启动至少一个线程用来执行程序中的代码
    - 这个线程被称之为主线程
      - 所以我们也可以说进程是线程的容器
- 进程就是一个块
  - 块代表一个应用: wx
- 这个块里面就会分为主线程和线程2, 线程3
- 会有多个块组成操作系统的一部分

## 操作系统的工作方式

- 操作系统是如何做到同时让多个进程（边听歌、边写代码、边查阅资料）同时工作
  - 这是因为CPU的运算速度非常快，
    - 它可以快速的在多个进程之间迅速的切换；
    - 当我们进程中的线程获取到时间片时;  就可以快速执行我们编写的代码
    - 对于用户来说是感受不到这种快速的切换的；

# 浏览器中JavaScript线程

- 我们经常会说JavaScript是单线程的 ( 可以开启workers) 
  - 但是JavaScript的线程应该有自己的容器进程 : 那么是浏览器或者Node

- 目前多数的浏览器其实都是的**多进程**的
  - 但我们打开一个tab页面时就会开启一个新的进程 
    - 这是为了防止一个页面卡死而造成, 所有页面无法响应
      - 卡死后果就是整个浏览器需要强制退出
- 每个进程中又有很多的线程 , 其中包括执行的JavaScript代码线程
- JavaScript的代码执行是在一个单独的线程中执行的
  - 这就意外着JavaScript的代码
    - 在同一个时刻只能做一件事
  - 如果这件事是非常耗时的
    - 就意味着当前的线程就会被阻塞
- 所有真正耗时的操作 , 实际上并不是由JavaScript线程在执行的
  - 浏览器的每个进程都是多线程的
    - 那么JavaScript线程执行全局代码时
      -  真正耗时的操作 , 会有其他线程可以来完成这个耗时的操作
        - 比如网络请求 , 定时器, 我们只需要再特定的时候 , 执行应该有的回调即可

# 浏览器的事件循环

- 如果在执行JavaScript代码的过程中
  - 有异步操作
    - 中间我们插入了一个setTimeout的函数调用
    - 这个函数被放到调用栈中,  执行会立即结束, 并不会阻塞后续代码的执行 , JavaScript线程会继续执行后续代码
      - setTimeout会经过浏览器放到事件队列里面
        - 等待计时结束

# 宏任务和微任务

- 事件循环中并非只维护着一个队列
  - 事实上是由两个队列的
- 宏任务队列 (macrotask queue) : 属于宏任务的
  - Ajax , setTimeout , setInterval , DOM监听 , Ul Rendering
- 微任务队列 (microtask queue) :属于微任务的
  - Promise的then回调
  - Mutation Observe API 
    - 监听DOM的变化的
  - queueMicrotask() 
    - 直接加入到微任务队列中
- 事件循环对于两个队列的优先级
  - MainSrcipt 中的代码优先执行 (全局的代码) 
  - 在执行任何一个宏任务之前 (不是队列 , 而是每一个宏任务)
    - 都会先查看微任务队列中是否会有任务需要执行
      - 宏任务执行之前 , 必须保证微任务队列是空的
      - 如果不为空 , 那么就优先执行微任务队列中的任务 ( 回调 )
